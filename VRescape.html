<!DOCTYPE html>
<html>
  <head>
    <title>WebVR</title>
    <script src="aframe.min.js"></script>
    <script>

    AFRAME.registerComponent('raycaster-autorefresh', {
      init: function () {
        var el = this.el;
        this.el.addEventListener('model-loaded', function () {
          var cursorEl = el.querySelector('[raycaster]');
          cursorEl.components.raycaster.refreshObjects();
        });
      }
    });


    AFRAME.registerComponent('fusable', {
      init: function () {
        this.cursorEl = document.querySelector('a-cursor');
        this.fusing = this.fusing.bind(this);
        this.el.addEventListener('fusing', this.fusing);
      },
      fusing: function() {
        this.cursorEl.dispatchEvent(new Event('start-fusing'));
      },
      remove: function() {
        this.el.removeEventListener('fusing', this.fusing);
      }
     });

    AFRAME.registerComponent('door-listener', {
     init: function () {
       var el = this.el;
       this.el.addEventListener('click', function (evt) {
         var camera = document.querySelector('a-camera');
         el.dispatchEvent(new Event('open-door'));
       });
     }
    });

    </script>
  </head>
  <body>

    <a-scene raycaster-autorefresh>


      <a-assets>
        <a-asset-item id="wall" src="resources/wall.gltf"></a-asset-item>
        <img id="carpet" src="resources/carpet.jpg">
        <a-asset-item id="sofa" src="resources/burlap_sofa.gltf"></a-asset-item>
        <a-asset-item id="door" src="resources/door.gltf"></a-asset-item> 
      </a-assets>


      <a-light type="directional" color="#fff" intensity="0.8" position="2 5 0" rotation="0 0 0"></a-light>
      <a-sky color="rgb(100,100,255)"></a-sky>

      
      <a-camera position="0 1.7 0">
        <a-cursor fuse="true" fuse-timeout="750">

        </a-cursor>
      </a-camera>
      <a-box position="0 2.5 -3" rotation="0 45 0" color="#4CC3D9" shadow></a-box>

      <a-sphere position="1 3.5 -4.5" radius="1" color="#EF2D5E" shadow></a-sphere>

      <a-cylinder position="1.75 2.75 -3" radius="0.5" height="1.5" color="#FFC65D" shadow></a-cylinder>


      <!-- Side walls -->
      <a-plane position="4 5.5 -6" rotation="0 -90 0" width="16" height="8" color="coral" shadow></a-plane>
      
      <a-plane position="-4 5.5 -6" rotation="0 90 0" width="16" height="8" color="coral" shadow></a-plane>

      <!-- Ceiling -->
      <a-plane position="0 9 -6" rotation="-270 0 0" width="8" height="16" shadow></a-plane>

      <!-- Floor -->
      <a-plane position="0 1.5 -6" src="#carpet" repeat="90 90" rotation="-90 0 0" width="8" height="16" color="#7BC8A4" shadow></a-plane>

      <!-- GTLF Images -->
      <a-gltf-model scale="1.7 1.7 1.7" position="0.2 1.5 -5.6" rotation="0 0 0" src="#wall" shadow></a-gltf-model>

       <a-gltf-model scale="1.7 1.7 1.7" position="-3.7 1.5 -2" rotation="0 90 0" src="#sofa" shadow></a-gltf-model>

       <a-gltf-model scale="2S.7 1.8 1.7" position="-2 1.5 -5.65" rotation="0 -180 0" src="#door" door-listener fusable clickable shadow></a-gltf-model> 

      <a-asset-item id="flashlight" src="resources/flashlight.gltf"></a-asset-item> 
      <a-gltf-model position="-1 1.5 0" rotation="0 0 0" scale="0.1 0.1 0.1" src="#flashlight" shadow can-pickup fusable flashlight-listener>
        <a-light color="#fff" decay="0.2" angle="30" intensity="0.1" distance="12" rotation="0 0 0" position="0 5 0" type="point">
      </a-light> 
      </a-gltf-model> 


    </a-assets>
  </body>
</html>